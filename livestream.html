<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Livestream - Neema Gospel Church</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* =========================
       BASE
    ========================== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background:#f1f4ff; color:#111; overflow-x:hidden; }
    img { max-width:100%; height:auto; display:block; }
    a { text-decoration:none; color: inherit; }
    .container { width: 94%; max-width: 1200px; margin: 0 auto; }

    /* Fade-in */
    .fade-in { animation: fadeIn 1.0s ease-out; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(18px);} to {opacity:1; transform: translateY(0);} }

    /* =========================
       HEADER / NAV
    ========================== */
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding: 15px 22px;
      background:#002b80; color:#fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      position: sticky; top: 0; z-index: 9999;
    }
    .logo-area { display:flex; align-items:center; gap: 10px; }
    .logo { height: 46px; width:auto; }
    .church-name { font-size: 20px; font-weight: 800; letter-spacing: .2px; }

    nav { display:flex; align-items:center; gap: 10px; }
    .nav-links { display:flex; align-items:center; gap: 18px; }
    .nav-links a { color:#fff; font-weight:700; font-size: 14px; opacity: .95; }
    .nav-links a:hover { color:#ff1a1a; opacity: 1; }
    .give-btn { background:#ff1a1a; padding: 10px 16px; border-radius: 8px; }

    .menu-icon {
      display:none;
      font-size: 26px;
      cursor:pointer;
      padding: 7px 12px;
      background:#ff1a1a;
      border-radius: 8px;
      color:#fff;
      user-select:none;
    }

    @media (max-width: 900px){
      .menu-icon { display:block; }
      .nav-links{
        position:absolute; left:0; top: 66px;
        width:100%;
        background:#002b80;
        display:flex;
        flex-direction: column;
        gap: 0;
        padding: 10px 0;
        transform: translateY(-120%);
        opacity: 0;
        pointer-events:none;
        transition: transform .35s cubic-bezier(.4,0,.2,1), opacity .25s ease;
      }
      .nav-links.show{
        transform: translateY(0);
        opacity: 1;
        pointer-events:auto;
      }
      .nav-links a{
        padding: 14px 18px;
        width: 100%;
        text-align:center;
        border-top: 1px solid rgba(255,255,255,0.10);
        font-size: 16px;
      }
      .nav-links a.give-btn{
        width: auto;
        margin: 14px auto 8px;
        border-top: none;
      }
    }

    /* =========================
       LIVESTREAM SECTION
    ========================== */
    .livestream-section{
      padding: 70px 16px;
      text-align:center;
      background: linear-gradient(to bottom, #f8faff, #ffffff);
    }
    .livestream-section h1{
      font-size: 36px;
      color:#002b80;
      margin-bottom: 6px;
    }
    .livestream-section .intro{
      font-size: 18px;
      max-width: 760px;
      margin: 0 auto 18px;
      color:#333;
    }

    /* Status badge */
    .live-status{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 14px;
      margin: 10px auto 22px;
      width: fit-content;
      background:#eee;
      color:#555;
    }
    .live-status .dot{
      width: 10px; height: 10px;
      border-radius: 50%;
      background: gray;
    }
    .live-status.live{
      background: rgba(255,26,26,0.15);
      color: #ff1a1a;
    }
    .live-status.live .dot{
      background:#ff1a1a;
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse{
      0% { transform: scale(1); opacity: 1; }
      70% { transform: scale(1.8); opacity: 0; }
      100% { opacity: 0; }
    }

    /* Video container */
    .live-video-container{
      max-width: 960px;
      margin: 18px auto 0;
      border-radius: 16px;
      overflow:hidden;
      background:#000;
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
      display:none; /* only when live */
    }
    .video-frame{
      position: relative;
      padding-top: 56.25%; /* 16:9 */
      background:#000;
    }
    .video-frame iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    /* Fullscreen */
    .video-actions{
      display:flex; justify-content:center; gap: 10px;
      padding: 14px;
      background: #050505;
    }
    .btn{
      display:inline-block;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 800;
      cursor:pointer;
      border:none;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn.fullscreen{
      background:#002b80;
      color:#fff;
    }
    .btn.fullscreen:hover{
      box-shadow: 0 10px 18px rgba(0,43,128,0.25);
      transform: translateY(-1px);
    }
    .btn.primary{
      background:#ff1a1a;
      color:#fff;
      border-radius: 10px;
      padding: 10px 16px;
      font-weight: 800;
    }
    .btn.primary:hover{ background:#cc0000; }

    /* Offline thumbnail */
    .offline-thumb{
      display:none; /* only when offline */
      max-width: 960px;
      margin: 18px auto 0;
      border-radius: 16px;
      overflow:hidden;
      position: relative;
      box-shadow: 0 14px 40px rgba(0,0,0,0.18);
      text-decoration:none;
      background:#000;
    }
    .offline-thumb img{
      width: 100%;
      height: auto;
      display:block;
      filter: saturate(0.95) contrast(0.98) brightness(0.85);
      transform: scale(1.01);
    }
    .offline-overlay{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      text-align:center;
      padding: 18px;
      background: rgba(0,0,0,0.45);
      color:#fff;
    }
    .offline-overlay h2{ margin:0 0 8px; font-size: 28px; }
    .offline-overlay p{ margin:0; font-size: 16px; opacity: .95; }

    /* Main action button */
    .live-btn{
      display:inline-block;
      margin-top: 26px;
      padding: 14px 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff1a1a, #cc0000);
      color:#fff;
      font-weight: 900;
      font-size: 16px;
      box-shadow: 0 12px 28px rgba(255, 26, 26, 0.45);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .live-btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 34px rgba(255, 26, 26, 0.55);
    }

    @media (max-width: 768px){
      .livestream-section h1{ font-size: 28px; }
      .livestream-section .intro{ font-size: 16px; }
      .offline-overlay h2{ font-size: 22px; }
      .offline-overlay p{ font-size: 14px; }
      .live-btn{ width: 100%; max-width: 420px; }
    }

    /* ===========================
       FOOTER (YOUR FULL VERSION)
    =========================== */
    .footer {
      background: #002b80;
      color: white;
      padding: 50px 20px 20px;
      margin-top: 70px;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 30px;
      max-width: 1200px;
      margin: auto;
    }

    .footer-col h3,
    .footer-col h4 {
      margin-bottom: 12px;
      color: white;
    }

    .footer-col p {
      color: #e0e7ff;
      line-height: 1.6;
      font-size: 14px;
    }

    .footer-col ul {
      list-style: none;
      padding: 0;
    }

    .footer-col ul li {
      margin-bottom: 8px;
    }

    .footer-col ul li a {
      color: #e0e7ff;
      text-decoration: none;
      font-size: 14px;
    }

    .footer-col ul li a:hover {
      color: #ff1a1a;
    }

    /* Newsletter box */
    .newsletter-box {
      margin-top: 18px;
      background: rgba(255,255,255,0.10);
      padding: 16px;
      border-radius: 12px;
    }

    .newsletter-box h4 {
      margin: 0 0 6px;
      color: #fff;
    }

    .newsletter-box p {
      color: #e0e7ff;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .newsletter-response {
      font-size: 13px;
      color: #e0e7ff;
      margin-top: 10px;
    }

    /* Social icons */
    .socials {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .social-icon {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      color: #002b80;
      border-radius: 50%;
      font-size: 18px;
      font-weight: bold;
      text-decoration: none;
      transition: .25s;
    }

    .social-icon:hover {
      transform: translateY(-3px);
      background: #ff1a1a;
      color: white;
    }

    /* Bottom Section */
    .footer-bottom {
      text-align: center;
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.25);
      color: #cbd5ff;
      font-size: 13px;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .footer-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .footer-container {
        grid-template-columns: 1fr;
        text-align: center;
      }
      .socials {
        justify-content: center;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="logo-area">
      <img src="logo.png" class="logo" alt="Neema Logo">
      <span class="church-name">Neema Gospel Church</span>
    </div>

    <nav>
      <div class="menu-icon" id="menuToggle">&#9776;</div>
      <div class="nav-links" id="navLinks">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="ministries.html">Ministries</a>
        <a href="events.html">Events</a>
        <a href="sermons.html">Sermons</a>
        <a href="gallery.html">Gallery</a>
        <a href="livestream.html">Livestream</a>
        <a href="newhere.html">New Here?</a>
        <a href="contact.html">Contact</a>
        <a href="giving.html" class="give-btn">Give</a>
      </div>
    </nav>
  </header>

  <!-- LIVESTREAM -->
  <section class="livestream-section fade-in">
    <h1>Watch Our Livestream</h1>
    <p class="intro">Join our worship services live from anywhere.</p>

    <!-- LIVE STATUS -->
    <div class="live-status offline" id="liveStatus">
      <span class="dot"></span>
      <span class="label" id="liveLabel">Checking live status…</span>
    </div>

    <!-- LIVE VIDEO -->
    <div class="live-video-container" id="liveContainer">
      <div class="video-frame" id="videoFrame">
        <iframe id="ytLive" src="" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
      </div>
      <div class="video-actions">
        <button class="btn fullscreen" id="fullscreenBtn" type="button">⛶ Full Screen</button>
      </div>
    </div>

    <!-- OFFLINE THUMBNAIL -->
    <a class="offline-thumb" id="offlineThumb" href="https://www.youtube.com/@ngc254" target="_blank" rel="noopener">
      <img id="offlineImg" src="offline.jpg" alt="Livestream Offline">
      <div class="offline-overlay">
        <h2>Livestream Offline</h2>
        <p>Tap to visit our YouTube channel for updates.</p>
      </div>
    </a>

    <!-- MAIN BUTTON -->
    <a href="https://www.youtube.com/@ngc254" target="_blank" rel="noopener" id="liveActionBtn" class="live-btn">
      Go to YouTube Channel
    </a>
  </section>

  <!-- ===========================
        FULL FOOTER (YOUR VERSION)
  =========================== -->
  <footer class="footer">
    <div class="footer-container">

      <div class="footer-col">
        <h3>Neema Gospel Church</h3>
        <p>A Christ-centered ministry transforming lives through the Word of God.</p>

        <div class="newsletter-box">
          <h4>Subscribe to Updates</h4>
          <p>Get church announcements & devotionals.</p>

          <a href="https://forms.microsoft.com/r/XtHcffGWjg?origin=lprLink"
             target="_blank"
             class="btn primary">
            Subscribe to Updates
          </a>

          <p id="newsletterResponse" class="newsletter-response"></p>
        </div>
      </div>

      <div class="footer-col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="about.html">About Us</a></li>
          <li><a href="ministries.html">Ministries</a></li>
          <li><a href="events.html">Events</a></li>
          <li><a href="sermons.html">Sermons</a></li>
          <li><a href="gallery.html">Gallery</a></li>
          <li><a href="livestream.html">Livestream</a></li>
          <li><a href="privacy.html">Privacy Policy</a></li>
          <li><a href="terms.html">Terms & Conditions</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Ministries</h4>
        <ul>
          <li><a href="ministries.html">Worship Team</a></li>
          <li><a href="ministries.html">Youth Ministry</a></li>
          <li><a href="ministries.html">Children's Ministry</a></li>
          <li><a href="ministries.html">Men's Fellowship</a></li>
          <li><a href="ministries.html">Women's Fellowship</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Contact Us</h4>
        <p>Ruiru, Kenya</p>
        <p>Phone: (254) 701 842 755</p>
        <p>Email: neemagospelchurchruiru@outlook.com</p>

        <div class="socials">
          <a class="social-icon fb" href="#" target="_blank" rel="noopener">f</a>
          <a class="social-icon ig" href="#" target="_blank" rel="noopener">♛</a>
          <a class="social-icon yt" href="https://youtube.com/@ngc254" target="_blank" rel="noopener">▶</a>
          <a class="social-icon wa" href="#" target="_blank" rel="noopener">✆</a>
        </div>
      </div>

    </div>

    <div class="footer-bottom">
      © <span id="currentYear"></span> Neema Gospel Church Ruiru— All Rights Reserved.
    </div>
  </footer>

  <script>
    /* =========================
       MENU + YEAR
    ========================== */
    document.addEventListener("DOMContentLoaded", () => {
      const menuToggle = document.getElementById("menuToggle");
      const navLinks = document.getElementById("navLinks");
      if (menuToggle && navLinks) {
        menuToggle.addEventListener("click", () => navLinks.classList.toggle("show"));
      }
      const y = document.getElementById("currentYear");
      if (y) y.textContent = new Date().getFullYear();
    });

    /* =========================
       LIVESTREAM LIVE/OFFLINE (REAL)
       Uses YouTube Data API v3
    ========================== */
    document.addEventListener("DOMContentLoaded", () => {
      const CHANNEL_ID = "UCYJVIThrcvGL22xu-q3I_FQ";

      // ✅ Put your YouTube Data API Key here
      const API_KEY = "AIzaSyDIu9Voj_d6LQXKmdbL48RgcjhSxG3KSsw";

      const liveStatus    = document.getElementById("liveStatus");
      const liveLabel     = document.getElementById("liveLabel");
      const liveContainer = document.getElementById("liveContainer");
      const iframe        = document.getElementById("ytLive");
      const offlineThumb  = document.getElementById("offlineThumb");
      const liveBtn       = document.getElementById("liveActionBtn");
      const fullscreenBtn = document.getElementById("fullscreenBtn");
      const videoFrame    = document.getElementById("videoFrame");

      if (!liveStatus || !liveLabel || !liveContainer || !offlineThumb || !liveBtn || !iframe) return;

      function setBadge(isLive, text){
        liveStatus.classList.toggle("live", isLive);
        liveStatus.classList.toggle("offline", !isLive);
        liveLabel.textContent = text || (isLive ? "LIVE NOW" : "Offline");
      }

      async function getLiveVideoId(){
        const url =
          "https://www.googleapis.com/youtube/v3/search" +
          `?part=snippet&channelId=${encodeURIComponent(CHANNEL_ID)}` +
          `&eventType=live&type=video&maxResults=1&key=${encodeURIComponent(API_KEY)}`;

        const res = await fetch(url);
        if (!res.ok) throw new Error("YouTube API failed");
        const data = await res.json();
        const item = data.items && data.items[0];
        return item && item.id && item.id.videoId ? item.id.videoId : null;
      }

      function showLive(videoId){
        setBadge(true, "LIVE NOW");
        offlineThumb.style.display = "none";
        liveContainer.style.display = "block";

        iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;

        liveBtn.textContent = "Open Live on YouTube";
        liveBtn.href = `https://www.youtube.com/watch?v=${videoId}`;
      }

      function showOffline(message){
        setBadge(false, message || "Offline");
        liveContainer.style.display = "none";
        offlineThumb.style.display = "block";
        iframe.src = "";

        liveBtn.textContent = "Go to YouTube Channel";
        liveBtn.href = "https://www.youtube.com/@ngc254";
      }

      async function refresh(){
        try{
          if (!API_KEY || !API_KEY.startsWith("AIza")) {
            showOffline("AIza");
            return;
          }

          setBadge(false, "Checking live status…");
          const liveVideoId = await getLiveVideoId();

          if (liveVideoId) showLive(liveVideoId);
          else showOffline("Offline");

        } catch (e){
          // Common reasons: quota exceeded, key restricted wrongly, network error
          showOffline("Offline (API check failed)");
        }
      }

      // Fullscreen (user click required)
      if (fullscreenBtn && videoFrame){
        fullscreenBtn.addEventListener("click", () => {
          if (videoFrame.requestFullscreen) videoFrame.requestFullscreen();
          else if (videoFrame.webkitRequestFullscreen) videoFrame.webkitRequestFullscreen();
          else if (videoFrame.msRequestFullscreen) videoFrame.msRequestFullscreen();
        });
      }

      // Run now + refresh every 60 seconds
      refresh();
      setInterval(refresh, 60000);
    });
  </script>
</body>
</html>
